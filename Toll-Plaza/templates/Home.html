{% extends "Base.html" %}
{% block title %}<title>Home Page</title>{% endblock title %}

{% block Style_local %}
        <link rel="stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/Home.css') }}">
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
       
        <script src="{{ url_for('static',filename='js/scripts.js') }}"></script>
        <script src="{{ url_for('static',filename='js/Allpayments.js') }}"></script>
        <link rel="stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/Log_in.css') }}">
        <link rel="stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/Sign_up.css') }}">
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js" integrity="sha512-57oZ/vW8ANMjR/KQ6Be9v/+/h6bq9/l3f0Oc7vn6qMqyhvPd1cvKBRWWpzu0QoneImqr2SkmO4MSqU+RpHom3Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <link rel="preload" as="style" href="https://mdbcdn.b-cdn.net/wp-content/themes/mdbootstrap4/docs-app/css/dist/mdb5/standard/core.min.css"
            onload="this.rel='stylesheet'">
      
        <script async src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
        <script async src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        <link rel='stylesheet' id='roboto-subset.css-css' href='https://mdbcdn.b-cdn.net/wp-content/themes/mdbootstrap4/docs-app/css/mdb5/fonts/roboto-subset.css?ver=3.9.0-update.5'
        type='text/css' media='all' />
        <style>
         table {
            
            border-collapse: collapse;
            width: 80%;
            border: 2px solid #000;
            background:linear-gradient(90deg,#0f0c29,#302b63,#24243e);
           
        }
        
        th, td {
            color:white;
            border: 1px solid #000;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #f2f2f2;
        }
    </style>

{% endblock Style_local %}

{% block navContent %}
<a href="#" id='Sign_up' class="nav-item nav-link" style="margin-right:20px;"></a>
<a href="#" id='Login' class="nav-item nav-link" style="margin-right:20px;"></a>
{% endblock navContent %}

{% block content %}

        <!-- Page Content-->
        <div class="container px-4 px-lg-3" style=" margin-top:40px;">
            <div class="row">
                <!-- Left Column for jssor_1 div -->
                <div class="col-lg-7">
                    <div id="jssor_1" style='position: relative; margin: 0px 0px 40px 0px; top: 50px; left: 0px; height: 280px; visibility: hidden;'>
                        <!-- Your slideshow content goes here -->
                        <div id='Slides' data-u="slides" style="cursor: default; position: relative; top: 0px; left: 0px; height: 280px; overflow: hidden;">
                    <div data-p="100">
                        <img alt="loader image" data-u="image" src="{{ url_for('static',filename='Assets/1.webp') }}" />
                    </div>
                    <div data-p="100" style="display: none;">
                        <img alt="loader image" data-u="image" src="{{ url_for('static',filename='Assets/Sign_up3.webp') }}" />
                    </div>
                    <div data-p="100" style="display: none;">
                        <img alt="loader image" data-u="image" src="{{ url_for('static',filename='Assets/2.webp') }}"/>
                    </div>
                    <div data-p="100" style="display: none;">
                        <img alt="loader image" data-u="image"src="{{ url_for('static',filename='Assets/4.webp') }}"/>
                    </div>
                    <div data-p="100" style="display: none;">
                        <img alt="loader image" data-u="image" src="{{ url_for('static',filename='Assets/Sign_up.webp') }}" />
                    </div>
                    </div>
                    <!-- Bullet Navigator -->
                    <div data-u="navigator" class="jssorb01" style="bottom:10px;right:2px;;">
                    <div data-u="prototype" style="width:12px;height:12px;"></div>
                    </div>
                    <!-- Arrow Navigator -->
                    <span data-u="arrowleft" class="jssora05l" style=" position:relative ;top:0px;left:8px;width:40px;height:40px;" data-autocenter="2"></span>
                    <span data-u="arrowright" class="jssora05r" style="top:0px;right:8px;width:40px;height:40px;" data-autocenter="2"></span>
                    </div>
                </div>

                <!-- Right Column for "SMOOTH SAILING" div -->
                <div class="col-lg-5" id='Name'>
                    <h2 class="font-weight-light">WELCOME TO SMOOTH SAILING</h2>
                    <p>This website functions as a digital toll collection platform, eleminating
                        the need for manual labour. It empowers users to explore an extensive range of
                        toll services and select the ones that suit their needs.</p>
                    <a class="btn btn-primary" href="#Main_content" >Check out</a>
                </div>
            </div>
         </div>

            <!-- Call to Action-->
            <div class="card text-white bg-secondary my-5 py-3 text-center d-flex flex-column" style="justify-content:center;align-items:center;">
                 <h3>Toll Rate</h3>
                
                <table border="1" >
                    <thead>
                        <tr>
                            <th style="color:black">Vehicle Type</th>
                            <th style="color:black">Single</th>
                            <th style="color:black">Return</th>
                            <th style="color:black">Monthly</th>
                        </tr>
                    </thead>
                    <tbody id="priceTableBody">
                        <!-- Table rows will be added here dynamically -->
                    </tbody>
                </table>
                 <p id='Discounts' style="font-family:arial;margin:0;padding-top:10px;padding-bottom:0;"> </p>
                  <div id="scroll-container">
                    <p style="padding-top:10px;font-size:18px;font-family:times-new;" id="ShowCupons"> </p>
                
                </div>
                
            </div>
           
            <!-- Content Row-->
            <div class="row gx-4 gx-lg-5" id="Main_content" style="padding-bottom:0;">
                <div class="col-md-4 mb-5">
                    <div class="card h-100">
                        <div class="card-body">
                            <h4 class="card-title">Quick Payment</h4><hr>
                            <p class="card-text">Use this option to pay Toll fee quickly <strong> even if you are not Logged in! </strong></p>
                        </div>
                        <div class="card-footer" style='text-align:right;'>
                            <a class="btn btn-primary btn-md" id="Quick_pay" href="#" data-toggle="modal" data-target="#paymentModal">Go</a>
                        </div>
                    </div>
                </div>

                <div class="col-md-4 mb-5" >
                    <div class="card h-100">
                        <div class="card-body">
                            <h4 class="card-title">Payment History</h4><hr>
                            <p class="card-text">Shows your recent Payments ( <strong>Requires Login</strong> )</p>
                        </div>
                        <div class="card-footer" style='text-align:right;'><a class="btn btn-primary btn-md" id="History" href="#!"  >Go</a></div>
                    </div>
                </div>
                <div class="col-md-4 mb-5">
                    <div class="card h-100">
                        <div class="card-body">
                            <h4 class="card-title">Your Wallet</h4><hr>
                            <p class="card-text">Shows your wallet information, Like <strong> Current Balance </strong>Some<strong>  Recent Transactions </strong> and many more details. <br>( <strong>Requires Login</strong> ) </p>
                        </div>
                        <div class="card-footer" style='text-align:right;'><a class="btn btn-primary btn-md" id="Wallet" href="#!">Go</a></div>
                    </div>
                </div>


            </div>
        </div>
        <!-- Footer-->
       
        
        <!-- Signup Modal -->
<div class="modal fade" id="signupModal" tabindex="-1" role="dialog" aria-labelledby="signupModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <!-- Signup form content goes here -->
            <div class="modal-body">
                <form id="form">
                    <h3>Smooth Sailing Portal</h3>
                    <p>Please fill in this form to create an account!</p>
                    <hr>
                    <div class="form-group">
                        <div class="input-group" style="height:95%;">
                            <span class="input-group-addon"><i class="fa fa-user"></i></span>
                            <input type="text" class="form-control" id="username" name="username" placeholder="Fullname" required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="fa fa-paper-plane"></i></span>
                            <input type="email" class="form-control" id="email" name="email" placeholder="Email Address" required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="fa fa-phone"></i></span>
                            <input type="text" class="form-control" id="mobile" name="mobile" placeholder="Mobile Number (Optional)" minlength="10">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="bi bi-gender-ambiguous"></i></span>
                            <select class="form-control" id="gender" name="gender" required="required" style="height:105% !important;">
                                <option value="" disabled selected class="text-muted">Select Gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="others">Others</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="fa fa-lock"></i></span>
                            <input  type="password" class="form-control" id="password" name="password" placeholder="Password" required="required" oninput="check_pass()">
                            <i class="bi bi-eye-slash-fill" id="eye1" onclick="show_hide1()"></i>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon">
                                <i class="fa fa-lock"></i>
                                <i class="fa fa-check"></i>
                            </span>
                            <input  type="text" class="form-control" id="confirm_password" name="confirm_password" placeholder="Confirm Password" required="required" oninput="check_pass()">
                            <i id="Right_wrong"></i>
                        </div>
                    </div>
                    
                    
                    <div class="form-group" id='Sign_up_btn'>
                        <button type="submit" class="btn btn-primary btn-md" id="Sign-up">Sign Up</button>
                    </div>
                    <hr style="margin-bottom:5px;">
                    
                    <div class="text-center" style="color:rgb(32, 217, 165)">Already have an account?
                        <a id="Login" onclick="showLoginModal()"><strong>Login Here</strong></a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>




    <!-- Login Modal -->
<div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog mx-auto" role="document" style="max-width: 500px;">
        <div class="modal-content mx-auto">
               <div class="modal-body mx-auto">
                    <div class="card-body p-md-2 mx-md-2">
    
                        <div class="text-center" style="margin:10px;">
                                <h4 class="mt-3 mb-5 pb-1"><p>Please login to your account</p></h4>
                        </div>
    
                        <form id="form" style="margin:10px;">
                            
                            <div class="form-outline mb-4" >
                            <input type="email" required  class="form-control" id="login_email" placeholder="Enter email address" />
                            
                            <label class="form-label" for="form2Example11"><i class="bi bi-envelope" style="color:rgb(231, 97, 25)"></i>Email ID</label>
                            </div>
                           
                            
                            <div class="form-outline mb-4" >
                            <input type="password" required class="form-control" id="login_password" placeholder="Enter password" />
                            <i class="bi bi-eye-slash-fill" id="eye2"  onclick="show_hide2()" ></i>
                            <label class="form-label" for="form2Example22"><i class="bi bi-lock-fill" style="color:rgb(218, 107, 28)"></i>Password</label>
                            
                            </div>
                            
                            <div class="text-center pt-1 mb-5 pb-1">
                            <button class="btn btn-primary btn-block fa-lg gradient-custom-2 mb-3" type="submit" id="login">Login</button>
                            <a class="text" id="Forgot_Pass" href="#" >Forgot password?</a>
                            </div>
        
                            <div class="d-flex align-items-center justify-content-center pb-4">
                                <p class="mb-0 me-2">Don't have an account?</p>
                                <button type="button" class="btn btn-outline-danger" id="Create" onclick="showSignupModal()">Create new</button>
                            </div>
                        </form>
                    </div>    
                </div>
            </div>
        </div>
    </div>




    <!-- Payment Modal -->
       <!-- Modal -->
<div class="modal fade" id="paymentModal" tabindex="-1" role="dialog" aria-labelledby="paymentModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="paymentModalLabel">Quick Toll Payment</h5>
                
            </div>
            <div class="modal-body">
                <form id="Payment_form" onsubmit="Process_Toll_pay()">
                    <div class="form-group" style="padding-bottom:7px;">
                        <label for="vehicleType" style="padding-bottom:5px;">Vehicle Type</label>
                        <select class="form-control" id="vehicleType" required>
                            <option value="" disabled selected>Select Vehicle Type</option>
                            <option value="car">Car</option>
                            <option value="jeep">Jeep</option>
                            <option value="van">Van</option>
                            <option value="truck">Truck</option>
                            <option value="lcv">Light Commercial Vehicles</option>
                            <option value="bus">Bus</option>
                            <option value="axel_3">3 Axel vehicles</option>
                            <option value="axel_4_6">4 to 6 Axel vehicles</option>
                            <option value="axel_7">7 or more axel vehicles</option>
                        </select>
                    </div>
                    
                    <div class="form-group" style="padding-bottom:7px;">
                        <label for="JourneyType" style="padding-bottom:5px;">Journey Type</label>
                        <select class="form-control" id="JourneyType" required>
                            <option value="" disabled selected class="text-muted">Select Load Type</option>
                            <option value="Single">Single</option>
                            <option value="Return">Return </option>
                            <option value="Monthly">Monthly </option>
                        </select>
                    </div>
                    <div class="form-group " style="padding-bottom:7px;">
                        <label for="registrationNumber" style="padding-bottom:5px;">Registration Number</label>
                        <input type="text" class="form-control" id="registrationNumber" required>
                    </div>
                    <div class="form-group" style="padding-bottom:7px;">
                        <p><strong>Amount: </strong><span id="amountDisplay">-</span></p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-success" id="Proceed_to_pay_toll"  >Pay</button>
                    </div>
                </form>

            </div>
            
        </div>
    </div>
</div>


{% endblock content %} 

{% block scripts %}
 <script>
var jsonData;

        async function fetchTollRate() {
            try {
                // Fetch the toll rate
                const tollResponse = await fetch('/get_toll_rate');

                // Check if the response status is OK (200)
                if (tollResponse.status === 200) {
                    // Parse the JSON response for toll rates
                    jsonData = await tollResponse.json();
                  

                    // Fetch the discount rate
                    const discountResponse = await fetch('/discounts');

                    // Check if the response status is OK (200) for discounts
                    if (discountResponse.status === 200) {
                        // Parse the JSON response for discounts
                        const discountData = await discountResponse.json();

                        // Calculate the discounted amount based on the discount rate
                        const discountRate = discountData.rate; // Replace with the actual field name
                        document.getElementById("Discounts").innerText=`Discounts applied: ${discountRate} %`;
                        
                        for (const vehicleType in jsonData) {
                            const journeyTypes = jsonData[vehicleType];
                            for (const journeyType in journeyTypes) {
                                const originalAmount = journeyTypes[journeyType];
                                const discountedAmount = calculateDiscountedAmount(originalAmount, discountRate);
                                journeyTypes[journeyType] = discountedAmount;
                            }
                        }
                          populateTable();
                        
                        // You can display the updated data in the table or elsewhere as needed.
                    } else {
                        // Handle the error or return a default value for discounts
                          populateTable();
                        throw new Error('Failed to fetch discount data');
                    }
                } else {
                    // Handle the error or return a default value for toll rates
                    throw new Error('Failed to fetch toll rate data');
                }
            } catch (error) {
                // Handle any errors that occurred during the fetch
                console.error(error);
            }
        }

        // Function to calculate the discounted amount
        function calculateDiscountedAmount(originalAmount, discountRate) {
            // Calculate the discounted amount
            const discountedAmount = originalAmount - (originalAmount * discountRate / 100);

            // Round the result to two decimal places and parse it as a float
            return parseFloat(discountedAmount.toFixed(2));
        }





    // Function to format vehicle type names
    function formatVehicleTypeName(name) {
        if (name.startsWith("axel")) {
            const parts = name.split("_");

            if (parts.length > 2)
                return `${parts[1]} to ${parts[2]} Axel`;
            return `${parts[1]} Axel`
        } else {
            return name.charAt(0).toUpperCase() + name.slice(1);
        }
    }

    function populateTable() {
    // Get the table body element
        const tableBody = document.getElementById("priceTableBody");

        // Convert JSON data into an array of objects
        const dataArray = [];
        for (const vehicleType in jsonData) {
            if (vehicleType !== "_id") {
                const formattedVehicleType = formatVehicleTypeName(vehicleType);
                const vehicleData = jsonData[vehicleType];
                dataArray.push({
                    vehicleType: formattedVehicleType,
                    ...vehicleData,
                });
            }
    }

        // Sort the array by the "single" category in ascending order
        dataArray.sort((a, b) => a.single - b.single);

        // Iterate through the sorted array and create table rows
        dataArray.forEach((dataItem) => {
            const newRow = document.createElement("tr");

            const vehicleTypeCell = document.createElement("td");
            vehicleTypeCell.textContent = dataItem.vehicleType;
            newRow.appendChild(vehicleTypeCell);

            // Create separate cells for "single," "return," and "monthly" values
            ["single", "return", "monthly"].forEach((category) => {
                const cell = document.createElement("td");
                cell.textContent = ` ${dataItem[category]}`;
                newRow.appendChild(cell);
            });

            tableBody.appendChild(newRow);
        });
    }


    // Call the async function to fetch the data when the page loads
    window.addEventListener('load', fetchTollRate);

    // Function to calculate and display the amount
    function calculateAmount() {
        const vehicleType = document.getElementById("vehicleType").value.toLowerCase();
        const journeyType = document.getElementById("JourneyType").value.toLowerCase();
        const amountDisplay = document.getElementById("amountDisplay");

        // Check if both vehicle type and journey type are selected
        if (vehicleType && journeyType) {
            const amount = jsonData[vehicleType][journeyType];
           amountDisplay.textContent = `₹ ${amount}`; // Display the amount
           amountDisplay.style.fontWeight='bold';
            document.getElementById("Proceed_to_pay_toll").innerText=`Pay ₹${amount}`;
        } else {
            amountDisplay.textContent = "-"; // Display a placeholder if not selected
        }
    }

    // Add event listeners to the select elements to trigger the calculation
    document.getElementById("vehicleType").addEventListener("change", calculateAmount);
    document.getElementById("JourneyType").addEventListener("change", calculateAmount);

    


</script>

            <script src="{{ url_for('static',filename='js/jssor.slider-22.0.6.min.js') }}" type="text/javascript"></script>
            <script type="text/javascript">
            jssor_1_slider_init = function() {

                var jssor_1_SlideshowTransitions = [
                {$Duration:1200,x:0.2,y:-0.1,$Delay:20,$Cols:8,$Rows:4,$Clip:15,$During:{$Left:[0.3,0.7],$Top:[0.3,0.7]},$Formation:$JssorSlideshowFormations$.$FormationStraightStairs,$Assembly:260,$Easing:{$Left:$Jease$.$InWave,$Top:$Jease$.$InWave,$Clip:$Jease$.$OutQuad},$Outside:true,$Round:{$Left:1.3,$Top:2.5}},
                {$Duration:1500,x:0.3,y:-0.3,$Delay:20,$Cols:8,$Rows:4,$Clip:15,$During:{$Left:[0.1,0.9],$Top:[0.1,0.9]},$SlideOut:true,$Formation:$JssorSlideshowFormations$.$FormationStraightStairs,$Assembly:260,$Easing:{$Left:$Jease$.$InJump,$Top:$Jease$.$InJump,$Clip:$Jease$.$OutQuad},$Outside:true,$Round:{$Left:0.8,$Top:2.5}},
                {$Duration:1500,x:0.2,y:-0.1,$Delay:20,$Cols:8,$Rows:4,$Clip:15,$During:{$Left:[0.3,0.7],$Top:[0.3,0.7]},$Formation:$JssorSlideshowFormations$.$FormationStraightStairs,$Assembly:260,$Easing:{$Left:$Jease$.$InWave,$Top:$Jease$.$InWave,$Clip:$Jease$.$OutQuad},$Outside:true,$Round:{$Left:0.8,$Top:2.5}},
                {$Duration:1500,x:0.3,y:-0.3,$Delay:80,$Cols:8,$Rows:4,$Clip:15,$During:{$Left:[0.3,0.7],$Top:[0.3,0.7]},$Easing:{$Left:$Jease$.$InJump,$Top:$Jease$.$InJump,$Clip:$Jease$.$OutQuad},$Outside:true,$Round:{$Left:0.8,$Top:2.5}},
                {$Duration:1800,x:1,y:0.2,$Delay:30,$Cols:10,$Rows:5,$Clip:15,$During:{$Left:[0.3,0.7],$Top:[0.3,0.7]},$SlideOut:true,$Reverse:true,$Formation:$JssorSlideshowFormations$.$FormationStraightStairs,$Assembly:2050,$Easing:{$Left:$Jease$.$InOutSine,$Top:$Jease$.$OutWave,$Clip:$Jease$.$InOutQuad},$Outside:true,$Round:{$Top:1.3}},
                {$Duration:1000,$Delay:30,$Cols:8,$Rows:4,$Clip:15,$SlideOut:true,$Formation:$JssorSlideshowFormations$.$FormationStraightStairs,$Assembly:2049,$Easing:$Jease$.$OutQuad},
                {$Duration:1000,$Delay:80,$Cols:8,$Rows:4,$Clip:15,$SlideOut:true,$Easing:$Jease$.$OutQuad},
                {$Duration:1000,y:-1,$Cols:12,$Formation:$JssorSlideshowFormations$.$FormationStraight,$ChessMode:{$Column:12}},
                {$Duration:1000,x:-0.2,$Delay:40,$Cols:12,$SlideOut:true,$Formation:$JssorSlideshowFormations$.$FormationStraight,$Assembly:260,$Easing:{$Left:$Jease$.$InOutExpo,$Opacity:$Jease$.$InOutQuad},$Opacity:2,$Outside:true,$Round:{$Top:0.5}},
                {$Duration:2000,y:-1,$Delay:60,$Cols:15,$SlideOut:true,$Formation:$JssorSlideshowFormations$.$FormationStraight,$Easing:$Jease$.$OutJump,$Round:{$Top:1.5}}
                ];

                var jssor_1_options = {
                $AutoPlay: true,
                $SlideshowOptions: {
                    $Class: $JssorSlideshowRunner$,
                    $Transitions: jssor_1_SlideshowTransitions,
                    $TransitionsOrder: 1
                },
                $ArrowNavigatorOptions: {
                    $Class: $JssorArrowNavigator$
                },
                $BulletNavigatorOptions: {
                    $Class: $JssorBulletNavigator$
                }
                };

                var jssor_1_slider = new $JssorSlider$("jssor_1", jssor_1_options);

                // Function to scale the slider
                function ScaleSlider() {
                    var refSize = document.body.clientWidth;
                    if (refSize) {
                        // Adjust the maximum width as needed
                    
                        jssor_1_slider.$ScaleWidth(Math.min(500,refSize));
                        jssor_1_slider.$ScaleHeight(250);
                    } else {
                        window.setTimeout(ScaleSlider, 30);
                    }
                }
                ScaleSlider();
                $Jssor$.$AddEvent(window, "load", ScaleSlider);
                $Jssor$.$AddEvent(window, "resize", ScaleSlider);
                $Jssor$.$AddEvent(window, "orientationchange", ScaleSlider);
                /*responsive code end*/
            };
            
            document.addEventListener('DOMContentLoaded', function() {
                check_login();
                    var isMobile = Math.min(window.screen.width, window.screen.height) < 768 || navigator.userAgent.indexOf("Mobi") > -1;
                window.addEventListener('resize', function() {
                        if(!isMobile)
                                location.reload();
                });
            });


       
            var elem=document.getElementsByClassName('col-lg-7');
            var p=Math.min(elem[0].clientWidth,800);
            document.getElementById('Slides').style.width=p+'px';
            document.getElementById('Slides').style.height='280px';
            document.getElementById('Slides').style.overflow='hidden';
            
            </script>

            <style>
            .jssorb01 {
                position: absolute;
            }
            .jssorb01 div, .jssorb01 div:hover, .jssorb01 .av {
                position: absolute;
                /* size of bullet elment */
                width: 12px;
                height: 12px;
                filter: alpha(opacity=70);
                opacity: .7;
                overflow: hidden;
                cursor: pointer;
                border: #000 2px solid;
            }
            .jssorb01 div { background-color: gray; }
            .jssorb01 div:hover, .jssorb01 .av:hover { background-color: #d3d3d3; }
            .jssorb01 .av { background-color: #fff; }
            .jssorb01 .dn, .jssorb01 .dn:hover { background-color: #555555; }
            .jssora05l, .jssora05r {
                display: block;
                position: absolute;
                /* size of arrow element */
                width: 40px;
                height: 40px;
                cursor: pointer;
            /*  background: url('img/a17.png') no-repeat;*/
                overflow: hidden;
            }
            .jssora05l { background-position: -10px -40px; }
            .jssora05r { background-position: -70px -40px; }
            .jssora05l:hover { background-position: -130px -40px; }
            .jssora05r:hover { background-position: -190px -40px; }
            .jssora05l.jssora05ldn { background-position: -250px -40px; }
            .jssora05r.jssora05rdn { background-position: -310px -40px; }
            .jssora05l.jssora05lds { background-position: -10px -40px; opacity: .3; pointer-events: none; }
            .jssora05r.jssora05rds { background-position: -70px -40px; opacity: .3; pointer-events: none; }
        </style>
        <script type="text/javascript">jssor_1_slider_init();</script>
        <!-- Bootstrap core JS-->
        <!-- Core theme JS-->
        
        <script>

    // Function to show the signup modal
        function showSignupModal() {
            $('#loginModal').modal('hide');
            $('#signupModal').modal('show');
        }

        // Attach an event listener to the "Sign Up" link
        document.getElementById('Sign_up').addEventListener('click', showSignupModal);

        
        function showLoginModal() {
    // Close the signup modal
            $('#signupModal').modal('hide');
            
            // Open the login modal
            $('#loginModal').modal('show');
        }

        document.getElementById('Login').addEventListener('click', showLoginModal);
        
        </script>
<script>
    function show_hide1(){
        console.log('called');
        var element=document.getElementById("password");
        console.log(element);
        var element_type=element.getAttribute("type");
        if(element_type=="password"){
            element.setAttribute("type","text");
            document.getElementById("eye1").setAttribute("class","bi bi-eye-fill");
        }
        else{
            element.setAttribute("type", "password");
            document.getElementById("eye1").setAttribute ("class","bi bi-eye-slash-fill");
        }
    }
async function register(username, password, email, mobile, gender) {
    if (mobile.length == 0) {
        mobile = '';
    }

    var requestBody = {
        name: username,
        password: password,
        email: email.toLowerCase(),
        mobile: mobile,
        gender: gender,
    };
    var content = JSON.stringify(requestBody);

    try {
        const response = await fetch("/sign_up", {
            method: "POST",
            headers: {
                'Content-Type': 'application/json'
            },
            body: content,
        });

        if (response.status === 200) {
            const data = await response.json();
            console.log("Response from server:", data.message);
            alert(data.message);
             showLoginModal();
        } else {
            const errorData = await response.json();
            console.error("Error:", errorData.message);
            // Show an error message to the user
            alert(errorData.message);
        }
    } catch (error) {
        console.error("Error:", error);
        // Show a generic error message to the user
        alert("An error occurred while registering.");
    }
}

    function check_pass(){
       
        var pass= document.getElementById("password").value;
        var d= document.getElementById("Right_wrong");
        
        if((pass.length===0 && document.getElementById('confirm_password').value.length===0)|| document.getElementById('confirm_password').value.length === 0 ){
            d.removeAttribute('class');
        }else if(pass===document.getElementById('confirm_password').value){
            d.setAttribute("class", "bi bi-check-circle-fill");
            d.setAttribute("style", "color:green;");
            
        }else{
            d.setAttribute("class", "bi bi-x-circle-fill");
            d.setAttribute("style", "color:red;");
        }
    }

    document.getElementById("mobile").addEventListener("blur", validateMobile);

</script>



<script type="text/javascript">
    async function sendEmailToLoginRoute(email,password) {
            try {
                // Make a POST request to the Flask login route with the email
                const response = await fetch("/login", {
                    method: "POST",
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email: email.toLowerCase() ,Password:password}),
                });
                const responseData = await response.json();
                console.log(responseData);
                // Handle the response as needed
                if (responseData.code=== 200) {
                   window.location.href='/profile';
                }else {
                    alert(responseData.message);
                }
            } catch (error) {
                console.error("There was a problem with the fetch operation:", error);
            }
    }


$("#registrationNumber").on("input", function() {
    var inputValue = $(this).val();
    
    if (inputValue.length > 14) {
        $(this).val(inputValue.slice(0,14)); // Truncate to 14 digits
    }
});
    

    function show_hide2(){
        var element=document.getElementById("login_password");
        var element_type=element.getAttribute("type");
        if(element_type=="password"){
            element.setAttribute("type","text");
            document.getElementById("eye2").setAttribute("class","bi bi-eye-fill");
        }
        else{
            element.setAttribute("type", "password");
            document.getElementById("eye2").setAttribute ("class","bi bi-eye-slash-fill");
        }
    }
    
</script>

{% endblock scripts %}

{% block ModuleSignup %}
<script type="text/javascript">
    
    //----- New Registration code start	  
    document.getElementById("Sign-up").addEventListener("click", async function () {
        var forms = document.getElementById('form');
        var result = forms.checkValidity();
        if (result == false)
            return;
        event.preventDefault();
        var email = document.getElementById("email").value;
        var password = document.getElementById("password").value;
        var username = document.getElementById("username").value;
        var confirm_password = document.getElementById("confirm_password").value;
        var mobile = document.getElementById("mobile").value; // New field
        var gender = document.getElementById("gender").value; // New field

        if (password != confirm_password) {
            alert("Passwords do not match!.");
            return;
        }

        if(username.length>40 || username.length<4){
            alert("Name can have minimum of 4 and maximum of 40 characters.");
            return;
        }
        await register(username,password, email,mobile,gender);
    });

</script>




{% endblock ModuleSignup %}

{% block ModuleLogin %}
<script type="text/javascript">

   document.getElementById("Forgot_Pass").addEventListener("click", async function () {
    var Provided;
    var email = document.getElementById("login_email").value;
    if (email) {
        Provided = email;
    } else {
        Provided = window.prompt("Enter Your Email to Reset your password:");
    }

    var errorMessage;
    if (Provided != "" && Provided != null) {
        if (ValidateEmail(Provided)) {
            var requestBody = {
                Email: Provided.toLowerCase(),
            };
            var content = JSON.stringify(requestBody);

            let response = await fetch("/reset_password", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: content
            });

            if (response.status === 200) {
                alert("Password reset email sent. Check your inbox.");
            } else {
                const responseData = await response.json();
                alert("Error: " + responseData.message);
            }
        } else {
            alert("Enter a valid Email.");
        }
    }
});

    document.getElementById("login").addEventListener("click", async function () {
        event.preventDefault();
        var email = document.getElementById("login_email").value;
        var password = document.getElementById("login_password").value;

        // Check if email and password are not empty
        if (!email || !password) {
            alert("Email and password are required.");
            return;
        }

        // Validate email format
        if (!await ValidateEmail(email)) {
            alert("Enter a valid email address.");
            return;
        }

        await sendEmailToLoginRoute(email, password);
        
    });
// ----- End


</script>

{% endblock ModuleLogin %}

